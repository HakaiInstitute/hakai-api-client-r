<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-CA">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filtering Example • hakaiApi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filtering Example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hakaiApi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.5.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/filtering.html">Filtering Example</a></li>
    <li><a class="dropdown-item" href="../articles/Viewing-Recent-Stations.html">Viewing Recent Stations</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/HakaiInstitute/hakai-api-client-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filtering Example</h1>
                        <h4 data-toc-skip class="author">Brett
Johnson</h4>
            
            <h4 data-toc-skip class="date">19/04/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HakaiInstitute/hakai-api-client-r/blob/master/vignettes/filtering.Rmd" class="external-link"><code>vignettes/filtering.Rmd</code></a></small>
      <div class="d-none name"><code>filtering.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HakaiInstitute/hakai-api-client-r" class="external-link">hakaiApi</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the client</span></span>
<span><span class="co">#   follow link in console and paste auth. code in console</span></span>
<span><span class="co">#   (ignore alignment issue)</span></span>
<span><span class="va">client</span> <span class="op">&lt;-</span> <span class="fu">hakaiApi</span><span class="fu">::</span><span class="va"><a href="../reference/Client.html">Client</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="filtering-data-with-the-api">Filtering data with the API<a class="anchor" aria-label="anchor" href="#filtering-data-with-the-api"></a>
</h2>
<p>Here’s a simple demonstration of how to filter data from the API. The
API has limits in terms of how much data you can download in one query.
So, instead of querying for all data of a certain type, it’s good to
narrow it down to the time period, sites, or parameters that you are
really interested in. Though the API has many options for querying,
filtering, and sorting data, most R users will be more comfortable
filtering data using R packages such as dplyr.</p>
<p>A good way to build a query is in steps. Let’s say we want all the
chlorophyll data from QU39, from after 2016, with only accepted values,
and only glass fibre filters (GF/F) from the surface.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First return some chl data with no filters</span></span>
<span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">"/eims/views/output/chlorophyll"</span></span>
<span><span class="va">all_chl</span> <span class="op">&lt;-</span> <span class="va">client</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">client</span><span class="op">$</span><span class="va">api_root</span>, <span class="va">endpoint</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># by default only 20 rows are returned</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">all_chl</span><span class="op">)</span> <span class="co"># Look at what columns are available to filter on</span></span>
<span></span>
<span><span class="co"># Narrow it down to QU39</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"?site_id=QU39"</span></span>
<span><span class="va">client</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">client</span><span class="op">$</span><span class="va">api_root</span>, <span class="va">endpoint</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Get back only accepted values</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"?site_id=QU39&amp;chla_flag=AV"</span></span>
<span><span class="va">client</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">client</span><span class="op">$</span><span class="va">api_root</span>, <span class="va">endpoint</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get values from 2017</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="st">"?site_id=QU39&amp;chla_flag=AV&amp;date.year=2017"</span></span>
<span><span class="va">client</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">client</span><span class="op">$</span><span class="va">api_root</span>, <span class="va">endpoint</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Include only GF/F from the surface</span></span>
<span><span class="co"># It may be useful to split up the queries and rejoin them over multiple lines</span></span>
<span><span class="co"># Using the paste() or paste0() functions</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"site_id=QU39"</span>,</span>
<span>  <span class="st">"chla_flag=AV"</span>,</span>
<span>  <span class="st">"date.year=2017"</span>,</span>
<span>  <span class="st">"filter_type=GF/F"</span>,</span>
<span>  <span class="st">"line_out_depth=0"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"&amp;"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">client</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">client</span><span class="op">$</span><span class="va">api_root</span>, <span class="va">endpoint</span>, <span class="st">"?"</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select only the columns I'm interested in</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"site_id=QU39"</span>,</span>
<span>  <span class="st">"chla_flag=AV"</span>,</span>
<span>  <span class="st">"date.year=2017"</span>,</span>
<span>  <span class="st">"filter_type=GF/F"</span>,</span>
<span>  <span class="st">"line_out_depth=0"</span>,</span>
<span>  <span class="st">"fields=date,chla,lab_technician"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"&amp;"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">client</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">client</span><span class="op">$</span><span class="va">api_root</span>, <span class="va">endpoint</span>, <span class="st">"?"</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This looks good so now you can assign a variable and remove the limit</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"site_id=QU39"</span>,</span>
<span>  <span class="st">"chla_flag=AV"</span>,</span>
<span>  <span class="st">"date.year=2017"</span>,</span>
<span>  <span class="st">"filter_type=GF/F"</span>,</span>
<span>  <span class="st">"line_out_depth=0"</span>,</span>
<span>  <span class="st">"fields=date,chla,lab_technician"</span>,</span>
<span>  <span class="st">"limit=-1"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"&amp;"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">a_great_chl_query</span> <span class="op">&lt;-</span> <span class="va">client</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">client</span><span class="op">$</span><span class="va">api_root</span>, <span class="va">endpoint</span>, <span class="st">"?"</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">a_great_chl_query</span><span class="op">$</span><span class="va">date</span>,</span>
<span>  <span class="va">a_great_chl_query</span><span class="op">$</span><span class="va">chla</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2017-01-01"</span>, <span class="st">"2018-01-01"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s say you’re only interested in receiving the highest 10 values
for chlorophyll from 2017 from the portal. We can do that with the API
as well using the sort descending capability and limiting the return to
only 10 values.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">endpoint</span> <span class="op">&lt;-</span> <span class="st">"/eims/views/output/chlorophyll"</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="st">"fields=date,chla,site_id,line_out_depth"</span>,</span>
<span>  <span class="st">"chla&gt;0"</span>, <span class="co"># Note: added chla&gt;0 to remove NA values</span></span>
<span>  <span class="st">"date.year=2017"</span>,</span>
<span>  <span class="st">"sort=-chla"</span>,</span>
<span>  <span class="st">"limit=10"</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"&amp;"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">top_10_chl</span> <span class="op">&lt;-</span> <span class="va">client</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">client</span><span class="op">$</span><span class="va">api_root</span>, <span class="va">endpoint</span>, <span class="st">"?"</span>, <span class="va">query</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For more great querying capabilities see <a href="https://hakaiinstitute.github.io/hakai-api/querying_data/" class="external-link">the
querying-data docs</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sam Albers, Taylor Denouden, Brett Johnson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
